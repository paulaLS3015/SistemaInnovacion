<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agendar Cita Médica - MNS</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="mednova.png" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />

    <!-- Agrega esto dentro del <head> para incluir QR Code library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

    <!-- DataTables CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css"
    />
  </head>
  <body>
    <nav
      class="navbar navbar-expand-lg bg-dark border-bottom border-body"
      data-bs-theme="dark"
    >
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img src="mednova.png" alt="logo" style="height: 45px" />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavAltMarkup"
          aria-controls="navbarNavAltMarkup"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav">
            <a
              class="nav-link active text-white fw-bold"
              aria-current="page"
              href="#"
              >Agenda una Cita</a
            >
          </div>
        </div>
      </div>
    </nav>

    <div class="container mt-5">
      <h1>Agenda tu Cita Médica</h1>
      <h4 style="color: gray; font-style: italic">Con MedNova Solutions</h4>
      <div class="row mt-5">
        <form class="row g-3" id="appointmentForm">
          <div class="col-md-6">
            <label for="inputId" class="form-label">Identificación</label>
            <input
              type="text"
              class="form-control"
              id="inputId"
              placeholder="1-1111-1111"
              required
            />
          </div>
          <div class="col-md-6">
            <label for="inputName" class="form-label">Nombre Completo</label>
            <input type="text" class="form-control" id="inputName" required />
          </div>
          <div class="col-md-6">
            <label for="inputEmail4" class="form-label"
              >Correo Electrónico</label
            >
            <input
              type="email"
              class="form-control"
              id="inputEmail4"
              required
            />
          </div>
          <div class="col-md-6">
            <label for="inputPhone" class="form-label">Teléfono</label>
            <input
              type="text"
              class="form-control"
              id="inputPhone"
              placeholder="1111-1111"
              required
            />
          </div>
          <div class="col-md-4">
            <label for="appointmentType" class="form-label">Tipo de Cita</label>
            <select class="form-select" id="appointmentType" required>
              <option value="">Seleccione un tipo</option>
              <option value="Presencial">Presencial</option>
              <option value="Virtual">Virtual</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="specialty" class="form-label">Especialidad</label>
            <select class="form-select" id="specialty" required>
              <option value="">Seleccione una especialidad</option>
              <option value="Medicina General">Medicina General</option>
              <option value="Pediatría">Pediatría</option>
              <option value="Dermatología">Dermatología</option>
              <option value="Ginecología">Ginecología</option>
              <option value="Otro">Otro</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="doctorName" class="form-label">Nombre del Doctor</label>
            <input
              type="text"
              class="form-control"
              id="doctorName"
              placeholder="Dr. Juan Pérez"
              required
            />
          </div>
          <div class="col-md-2">
            <label for="inputDateTime" class="form-label">Fecha y Hora</label>
            <input
              type="datetime-local"
              class="form-control"
              id="inputDateTime"
              required
            />
          </div>
          <div class="col-10">
            <label for="inputDetails" class="form-label">Detalles</label>
            <input
              type="text"
              class="form-control"
              id="inputDetails"
              placeholder="Ingrese detalles de la cita o alguna nota para el doctor."
            />
          </div>
          <div class="col-12" style="margin-top: 50px">
            <button type="submit" class="btn btn-primary">Agendar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Historial de medicamentos (prototipo) -->
    <div class="container mt-5">
      <div class="card m-5" style="border-radius: 10px">
        <div
          class="card-header bg-secondary text-white"
          style="border-radius: 10px 10px 0 0"
        >
          Historial de Medicamentos (Prototipo)
        </div>
        <div class="card-body">
          <!--<p><strong>Paciente:</strong> ---</p>-->
          <table id="medTable" class="table table-striped">
            <thead>
              <tr>
                <th>Medicamento</th>
                <th>Frecuencia</th>
                <th>Última Receta</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Paracetamol 500mg</td>
                <td>2 veces al día</td>
                <td>10/03/2025</td>
              </tr>
              <tr>
                <td>Amoxicilina 875mg</td>
                <td>3 veces al día</td>
                <td>05/02/2025</td>
              </tr>
              <tr>
                <td>Loratadina 10mg</td>
                <td>1 vez al día</td>
                <td>22/01/2025</td>
              </tr>
            </tbody>
          </table>
          <small class="text-muted"
            >* Esta información es solo demostrativa.</small
          >
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div
        id="liveToast"
        class="toast"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="toast-header">
          <strong class="me-auto">Confirmación</strong>
          <small>Ahora</small>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
        <div class="toast-body">La cita ha sido agendada correctamente.</div>
      </div>
    </div>

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- jQuery + DataTables + Buttons -->
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>

    <script>
      $(document).ready(function () {
        $("#medTable").DataTable({
          dom: "Bfrtip",
          buttons: ["excelHtml5", "pdfHtml5"],
          language: {
            decimal: "",
            emptyTable: "No hay datos disponibles en la tabla",
            info: "Mostrando _START_ a _END_ de _TOTAL_ entradas",
            infoEmpty: "Mostrando 0 a 0 de 0 entradas",
            infoFiltered: "(filtrado de _MAX_ entradas totales)",
            infoPostFix: "",
            thousands: ",",
            lengthMenu: "Mostrar _MENU_ entradas",
            loadingRecords: "Cargando...",
            processing: "Procesando...",
            search: "Buscar:",
            zeroRecords: "No se encontraron registros coincidentes",
            paginate: {
              first: "Primero",
              last: "Último",
              next: "Siguiente",
              previous: "Anterior",
            },
            aria: {
              sortAscending: ": activar para ordenar la columna ascendente",
              sortDescending: ": activar para ordenar la columna descendente",
            },
            buttons: {
              copy: "Copiar",
              excel: "Excel",
              pdf: "PDF",
              print: "Imprimir",
            },
          },
        });
      });

      document
        .getElementById("appointmentForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          if (!this.checkValidity()) {
            this.reportValidity();
            return;
          }

          const id = document.getElementById("inputId").value;
          const name = document.getElementById("inputName").value;
          const email = document.getElementById("inputEmail4").value;
          const phone = document.getElementById("inputPhone").value;
          const dateTime = document.getElementById("inputDateTime").value;
          const details = document.getElementById("inputDetails").value;
          const type = document.getElementById("appointmentType").value;
          const specialty = document.getElementById("specialty").value;
          const doctor = document.getElementById("doctorName").value;

          // 👉 Formatear fecha y hora
          const dateObj = new Date(dateTime);
          const formattedDate = `${dateObj
            .getDate()
            .toString()
            .padStart(2, "0")}/${(dateObj.getMonth() + 1)
            .toString()
            .padStart(2, "0")}/${dateObj.getFullYear()} a las ${dateObj
            .getHours()
            .toString()
            .padStart(2, "0")}:${dateObj
            .getMinutes()
            .toString()
            .padStart(2, "0")}`;

          // 👉 Generar consecutivo alfanumérico único
          const generateConsecutive = () => {
            const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            const numbers = "0123456789";
            let result = "MN"; // Prefijo, por ejemplo "MN" de MedNova
            for (let i = 0; i < 3; i++)
              result += letters.charAt(
                Math.floor(Math.random() * letters.length)
              );
            for (let i = 0; i < 4; i++)
              result += numbers.charAt(
                Math.floor(Math.random() * numbers.length)
              );
            return result;
          };

          const consecutivo = generateConsecutive();

          // Mostrar toast
          const toastLiveExample = document.getElementById("liveToast");
          const toastBootstrap =
            bootstrap.Toast.getOrCreateInstance(toastLiveExample);
          toastBootstrap.show();

          // Generar PDF con jsPDF
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          doc.setFont("helvetica", "bold");
          doc.text("Confirmación de Cita Médica", 20, 20);
          doc.setFont("helvetica", "normal");

          doc.text(`Consecutivo: ${consecutivo}`, 20, 30);
          doc.text(`Identificación: ${id}`, 20, 40);
          doc.text(`Nombre: ${name}`, 20, 50);
          doc.text(`Correo: ${email}`, 20, 60);
          doc.text(`Teléfono: ${phone}`, 20, 70);
          doc.text(`Fecha y Hora: ${formattedDate}`, 20, 80);
          doc.text(`Tipo de Cita: ${type}`, 20, 90);
          doc.text(`Especialidad: ${specialty}`, 20, 100);
          doc.text(`Doctor: ${doctor}`, 20, 110);
          doc.text(
            `Detalles: ${details || "No se proporcionaron detalles."}`,
            20,
            120
          );

          doc.setFont("helvetica", "italic");
          doc.text("Gracias por elegir MedNova Solutions.", 20, 140);
          doc.text("¡Nos vemos pronto!", 20, 150);

          // QR con consecutivo incluido
          const qrContent = `${consecutivo}`;
          const qr = new QRious({
            value: qrContent,
            size: 100,
          });
          const qrImage = qr.toDataURL("image/png");
          doc.addImage(qrImage, "PNG", 150, 20, 40, 40);

          doc.save(`Cita_${consecutivo}.pdf`);
          this.reset();
        });
    </script>

    <!-- Bootstrap JS y Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
  </body>
</html>
